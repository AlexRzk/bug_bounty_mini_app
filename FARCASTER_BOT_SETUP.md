# Farcaster Bot Setup Guide ü§ñ

This guide shows you how to set up the Farcaster bot that lets users create bounties by using Farcaster Actions or posting bounty casts.

## Features

‚úÖ **Farcaster Actions** - One-click bounty creation from any cast  
‚úÖ **Auto-discovery** - Bot searches for bounty keywords every 5 minutes  
‚úÖ **Auto-parsing** - Extracts title, reward, severity from natural language  
‚úÖ **On-chain Creation** - Automatically submits transactions to Base  
‚úÖ **Free Tier Compatible** - Works with Neynar free plan!

## Setup Steps

### 1. Create Neynar Account (Free Tier OK!)

1. Go to [https://dev.neynar.com/](https://dev.neynar.com/)
2. Sign up and create a new app
3. Copy your **API Key** from the dashboard

**That's it for Neynar!** No webhooks or signers needed on free tier.

### 2. Create Bot Wallet

Create a new Ethereum wallet for the bot to submit transactions:

```bash
# Using cast (Foundry)
cast wallet new

# Or use MetaMask to create a new account
```

**IMPORTANT:** 
- Fund this wallet with ~0.1 ETH on Base mainnet for gas fees
- Keep the private key secure - add to `.env.local`, never commit to git
- This wallet acts as a proxy to submit bounties on behalf of users

### 3. Configure Environment Variables

Add to your `.env.local`:

```env
# Neynar API Configuration (Free Tier Compatible!)
NEYNAR_API_KEY=your_neynar_api_key

# Bot Wallet (for submitting transactions)
BOT_PRIVATE_KEY=0xyour_private_key_here

# Optional: Cron secret for security
CRON_SECRET=random_secret_string_here
```

### 4. Deploy to Vercel

```bash
# Add environment variables to Vercel
vercel env add NEYNAR_API_KEY
vercel env add BOT_PRIVATE_KEY
vercel env add CRON_SECRET  # Optional but recommended

# Deploy
git push origin main
```

**Note:** Vercel Cron jobs check for bounty casts every 5 minutes (configurable in `vercel.json`)

### 5. Test the Bot

#### Method 1: Post a Bounty Cast

Post a cast on Farcaster (no need to tag anyone!):

```
Create bounty: Fix login redirect bug #reward:0.1 #severity:high

Need someone to fix the authentication redirect issue on our app
```

The bot will (within 5 minutes):
1. Find your cast via keyword search
2. Parse bounty details
3. Create bounty on Base
4. You can check Vercel logs for confirmation

#### Method 2: Use Farcaster Action

1. Users install the action: `https://bug-bounty-mini-app.vercel.app/api/actions/create-bounty`
2. Write a cast describing the bounty
3. Click the "Create Bounty" action button
4. Bot creates the bounty instantly

## Bounty Format

### Hashtag-based (Recommended)

```
Create bounty: [Title] #reward:0.1 #severity:high #category:frontend

[Optional longer description]
```

**Supported hashtags:**
- `#reward:0.1` - Reward amount in ETH (required)
- `#severity:low|medium|high|critical` - Bug severity (optional, defaults to medium)
- `#category:frontend|backend|smart-contract` - Bounty category (optional)

### Natural Language

```
Need someone to fix authentication bug, willing to pay 0.1 ETH. This is a critical issue.
```

The parser extracts:
- Reward from "0.1 ETH" or similar patterns
- Severity from keywords: "critical", "urgent", "high priority", etc.
- Title from first sentence
- Description from remaining text

## How It Works

```
User posts cast mentioning bot
    ‚Üì
Vercel Cron runs every 5 minutes
    ‚Üì
Check Neynar API for new mentions
    ‚Üì
Parse bounty details from cast text
    ‚Üì
Bot wallet submits transaction to BountyManager contract
    ‚Üì
Reply to cast with confirmation or error
```

**Polling vs Webhooks:**
- ‚úÖ Works on Neynar free tier
- ‚úÖ No webhook configuration needed
- ‚è±Ô∏è ~5 minute delay (vs instant webhooks)
- üí∞ Saves money (no paid Neynar plan required)

## Security Notes

‚ö†Ô∏è **Bot Private Key**
- Never commit to git
- Use Vercel environment variables
- Fund with minimal ETH (~0.1 ETH for gas)
- Rotate periodically

‚ö†Ô∏è **Cron Secret**
- Optional but recommended for security
- Prevents unauthorized cron execution
- Add to Vercel environment variables
- Use a random string (e.g., generated by `openssl rand -hex 32`)

‚ö†Ô∏è **Rate Limiting**
- Consider adding rate limits to prevent spam
- Track bounties per user per day
- Implement minimum reward thresholds

## Troubleshooting

### Bot doesn't find bounty casts

1. Check Vercel Cron is running: Visit Vercel dashboard ‚Üí Your project ‚Üí Cron Jobs
2. Verify `NEYNAR_API_KEY` is set correctly in Vercel environment variables
3. Check Vercel function logs for errors: `vercel logs`
4. Ensure your casts include keywords like "create bounty" or "#bounty"
5. Test manually: `curl https://your-app.vercel.app/api/monitor/mentions -H "Authorization: Bearer YOUR_CRON_SECRET"`

### Transaction fails

1. Check bot wallet has sufficient ETH on Base
2. Verify `BOUNTY_MANAGER_ADDRESS` is correct
3. Check Base RPC is responding
4. Review transaction in BaseScan

### Parser doesn't extract details

1. Ensure cast includes `#reward:X` or "X ETH"
2. Use "Create bounty:" prefix for clarity
3. Check console logs for parser output
4. Test with example formats above

## Cost Estimation

- **Neynar API**: Free tier (10k requests/month)
- **Gas per bounty**: ~$0.10 - $0.50 (Base L2)
- **Warps (for replies)**: ~100 warps per reply

For 100 bounties/month: ~$10-50 in gas fees

## Next Steps

1. ‚úÖ Configure environment variables
2. ‚úÖ Deploy to Vercel
3. ‚úÖ Test with sample cast
4. üì¢ Announce the feature to your community
5. üìä Monitor usage and gas costs
6. üîß Adjust rate limits and parsers as needed

## Support

- Neynar Docs: https://docs.neynar.com/
- Farcaster Actions: https://docs.farcaster.xyz/reference/actions/spec
- Base Docs: https://docs.base.org/

---

Made with ‚ù§Ô∏è for the Farcaster community
